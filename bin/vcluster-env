#!/usr/bin/env bash

TMPDIR=$(mktemp -d)
SERVER=$(kubectl config view --output jsonpath='{.clusters[0].cluster.server}')
PROMPT="\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h/vcluster\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ "

kubectl get secrets --namespace vcluster vc-vcluster --output=jsonpath='{.data.config}' | base64 -d > ${TMPDIR}/.config
KUBECONFIG=${TMPDIR}/.config kubectl config set clusters.kubernetes.server ${SERVER/6443/32443}
KUBECONFIG=${TMPDIR}/.config ${SHELL} --init-file <(echo "export PS1=\"${PROMPT}\"")

rm -rf ${TMPDIR}
