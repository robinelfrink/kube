suite: clusterissuers
templates:
  - letsencrypt-staging.yaml
tests:
  - it: should pass
    set:
      adminEmail: user@example.com
    release:
      name: clusterissuers-test-name
      namespace: clusterissuers-test-namespace
    asserts:
      - hasDocuments:
          count: 1
      - isAPIVersion:
          of: cert-manager.io/v1
      - isKind:
          of: ClusterIssuer
      - equal:
          path: metadata.name
          value: letsencrypt-staging
      - equal:
          path: spec
          value:
            acme:
              server: https://acme-staging-v02.api.letsencrypt.org/directory
              email: user@example.com
              privateKeySecretRef:
                name: letsencrypt
              solvers:
                - http01:
                    ingress:
                      class: nginx
                      podTemplate:
                        spec:
                          tolerations:
                            - effect: NoExecute
                              key: node.kubernetes.io/not-ready
                              operator: Exists
                              tolerationSeconds: 300
                            - effect: NoExecute
                              key: node.kubernetes.io/unreachable
                              operator: Exists
                              tolerationSeconds: 300
                            - effect: NoSchedule
                              key: node-role.kubernetes.io/master
